(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[function(e,t,a){e.exports=a(1)},function(e,t,a){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(h){n=!0,r=h}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function n(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}a.r(t),new(function(){function e(t){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateCamera=function(){var e=Date.now(),t=a.input,i=a.camera,n=a.map;t.keypressed=!1,0!=t.leftright&&(i.angle+=.1*t.leftright*(e-t.time)*.03,t.keypressed=!0),0!=t.forwardbackward&&(i.x-=t.forwardbackward*Math.sin(i.angle)*(e-t.time)*.03,i.y-=t.forwardbackward*Math.cos(i.angle)*(e-t.time)*.03,t.keypressed=!0),0!=t.updown&&(i.height+=t.updown*(e-t.time)*.03,t.keypressed=!0),t.lookup&&(i.horizon+=2*(e-t.time)*.03,t.keypressed=!0),t.lookdown&&(i.horizon-=2*(e-t.time)*.03,t.keypressed=!0);var r=((Math.floor(i.y)&n.width-1)<<n.shift)+(Math.floor(i.x)&n.height-1)|0;n.altitude[r]+10>i.height&&(i.height=n.altitude[r]+10),t.time=e},this.resize=function(){var e=a.element,t=a.screen,i=window,n=i.innerWidth,r=i.innerHeight,o=e.getContext("2d"),s=n/r;a.width=n<800?n:800,a.height=Math.floor(e.width/s);var h=a.width,u=a.height;e.width=h,e.height=u,t.imagedata=o.createImageData(h<800?h:800,u),t.bufarray=new ArrayBuffer(t.imagedata.width*t.imagedata.height*4),t.buf8=new Uint8Array(t.bufarray),t.buf32=new Uint32Array(t.bufarray)},this.getMousePosition=function(e){var t=e.pageX,a=e.pageY,n=e.type,r=e.targetTouches,o=i(r=void 0===r?[]:r,1)[0],s=(o=void 0===o?{}:o).pageX,h=o.pageY;return n.startsWith("touch")?[s,h]:[t,a]},this.detectMouseDown=function(e){var t=a.input;t.forwardbackward=3,t.mouseposition=a.getMousePosition(e),t.time=(new Date).getTime()},this.detectMouseUp=function(){var e=a.input;e.mouseposition=null,e.forwardbackward=0,e.leftright=0,e.updown=0},this.detectMouseMove=function(e){e.preventDefault();var t=a.input,i=a.camera;if(null!=t.mouseposition&&0!=t.forwardbackward){var n=a.getMousePosition(e);t.leftright=(t.mouseposition[0]-n[0])/window.innerWidth*2,i.horizon=100+(t.mouseposition[1]-n[1])/window.innerHeight*500,t.updown=(t.mouseposition[1]-n[1])/window.innerHeight*10}},this.detectKeysDown=function(e){var t=e.keyCode,i=a.input,n=a.updating;switch(t){case 37:case 65:i.leftright=1;break;case 39:case 68:i.leftright=-1;break;case 38:case 87:i.forwardbackward=3;break;case 40:case 83:i.forwardbackward=-3;break;case 82:i.updown=2;break;case 70:i.updown=-2;break;case 69:i.lookup=!0;break;case 81:i.lookdown=!0;break;default:return}return n||(i.time=(new Date).getTime()),!1},this.detectKeysUp=function(e){var t=e.keyCode,i=a.input;switch(t){case 37:case 65:i.leftright=0;break;case 39:case 68:i.leftright=0;break;case 38:case 87:i.forwardbackward=0;break;case 40:case 83:i.forwardbackward=0;break;case 82:case 70:i.updown=0;break;case 69:i.lookup=!1;break;case 81:i.lookdown=!1;break;default:return}return!1},this.flip=function(){var e=a.element,t=a.screen,i=e.getContext("2d");t.imagedata.data.set(t.buf8),a.hasLoggedImgData||(console.log(t.imagedata),a.hasLoggedImgData=!0),i.putImageData(t.imagedata,0,0)},this.fetchImages=function(e){return new Promise(function(t){var i=a.map,n=i.width,r=i.height,o=[],s=e.length;0!==s?e.map(function(e,a){var i=new Image;i.onload=function(){var e=document.createElement("canvas"),h=e.getContext("2d");e.width=n,e.height=r,h.drawImage(i,0,0,n,r),o[a]=h.getImageData(0,0,n,r).data,0>=--s&&t(o)},i.src=e}):t([])})},this.loadMap=function(){var e=a.map,t=a.map,i=t.urls,n=i.color,r=i.height,o=t.width,s=t.height;a.fetchImages([n,r]).then(function(t){for(var i=t[0],n=t[1],r=0;r<o*s;r++)e.color[r]=4278190080|i[2+(r<<2)]<<16|i[1+(r<<2)]<<8|i[0+(r<<2)],e.altitude[r]=n[r<<2];a.resize(),window.requestAnimationFrame(function(e){return a.tick(e)}),window.resize=a.resize})},this.drawVerticalLine=function(e,t,i,n){var r=a.width,o=void 0===r?0:r,s=a.screen.buf32;if(e|=0,n|=0,(t|=0)<0&&(t=0),!(t>(i|=0)))for(var h=t*o+e|0,u=0|t;u<i|0;u=u+1|0)s[0|h]=0|n,h=h+o|0},this.drawVoxels=function(){for(var e=a.camera,t=e.angle,i=e.distance,n=e.x,r=e.y,o=e.height,s=e.horizon,h=a.map,u=h.width,c=h.height,d=h.shift,l=h.altitude,f=h.color,w=a.width,p=void 0===w?0:w,g=a.height,m=void 0===g?0:g,k=u-1,v=c-1,b=Math.sin(t),y=Math.cos(t),M=new Int32Array(p),D=0;D<p;D=D+1|0)M[D]=m;for(var x=1,I=1;I<i;I+=x){var A=-y*I-b*I,z=b*I-y*I,C=(y*I-b*I-A)/p,U=(-b*I-y*I-z)/p;A+=n,z+=r;for(var T=1/I*240,P=0;P<p|0;P=P+1|0){var E=((Math.floor(z)&k)<<d)+(Math.floor(A)&v)|0,F=(o-l[E])*T+s|0;a.drawVerticalLine(P,F,M[P],f[E]),F<M[P]&&(M[P]=F),A+=C,z+=U}x+=.005}},this.element=t,this.screen={imagedata:null,bufarray:null,buf8:null,buf32:null,backgroundcolor:4292907152},this.camera={x:512,y:800,height:78,angle:0,horizon:100,distance:800},this.input={time:Date.now(),forwardbackward:0,leftright:0,updown:0,lookup:!1,lookdown:!1,mouseposition:null,keypressed:!1},this.map={width:1024,height:1024,shift:10,altitude:new Uint8Array(1048576),color:new Uint32Array(1048576),urls:{color:"./C1W.png",height:"./D1.png"}},t.onkeydown=this.detectKeysDown,t.onkeyup=this.detectKeysUp,t.onmousedown=this.detectMouseDown,t.onmouseup=this.detectMouseUp,t.onmousemove=this.detectMouseMove,t.ontouchstart=this.detectMouseDown,t.ontouchend=this.detectMouseUp,t.ontouchmove=this.detectMouseMove,this.updating=!1,this.loadMap()}var t,a,r;return t=e,(a=[{key:"getFps",value:function(){var e=0;if(this.last){var t=(Date.now()-this.last)/1e3;this.last=Date.now(),e=1/t}else this.last=Date.now();this.fps&&this.fps.length?(this.fps.push(e),100<this.fps.length&&this.fps.shift()):this.fps=[e];var a=this.fps.reduce(function(e,t){return e+t});return Math.floor(a/this.fps.length)}},{key:"drawDebug",value:function(e){var t=this.element,a=this.width,i=this.height,n=t.getContext("2d"),r=this.getFps();n.font="24px courier new",n.fillStyle="black",n.textAlign="left",n.fillText("".concat(a,"x").concat(i,"@").concat(r),36,52)}},{key:"tick",value:function(e){var t=this;this.updating=!0,this.resize(),this.updateCamera(),this.drawVoxels(),this.flip(),this.drawDebug(e),this.input.keypressed||(this.updating=!1),window.requestAnimationFrame(function(e){return t.tick(e)})}}])&&n(t.prototype,a),r&&n(t,r),e}())(document.getElementById("voxel"))}],[[0,1]]]);
//# sourceMappingURL=main.90cfb755.chunk.js.map